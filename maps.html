<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>All Maps we track</title>
<link rel="icon" type="image/png" href="/home/image1.png?v=2" sizes="32x32">
<link rel="shortcut icon" href="/home/image1.png?v=2">
<link rel="apple-touch-icon" href="/home/image1.png?v=2">
<style>
  :root{--bg:#0f1220;--panel:#161a2b;--accent:#7bdcff;--muted:#9aa4bf;--text:#e9efff;--border:rgba(255,255,255,.08);}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.4}
  header{position:sticky;top:0;z-index:2;background:linear-gradient(180deg,rgba(15,18,32,.95),rgba(15,18,32,.70));backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  .container{max-width:1200px;margin:0 auto;padding:16px}
  h1{font-size:clamp(22px,3vw,32px)}
  .sub-lg{font-size:clamp(16px,2.2vw,20px);margin-top:6px}
  .sub-sm{color:var(--muted);font-size:13px;margin-top:6px}
  .toolbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:12px}
  .btn{padding:10px 12px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:10px;cursor:pointer;font-size:14px;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}
  .btn:hover{border-color:#2a3150}
  .select,.input{padding:10px 12px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:10px;font-size:14px}
  .grid{margin:16px auto;background:var(--panel);border:1px solid var(--border);border-radius:16px;overflow:visible}
  .grid-scroll{width:100%;overflow:auto;border-radius:16px}
  table{width:100%;border-collapse:collapse}
  thead th{position:relative;text-align:left;padding:12px;font-size:14px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(22,26,43,.5),rgba(22,26,43,0))}
  tbody td{padding:12px;border-bottom:1px solid var(--border);vertical-align:top}
  tbody tr:hover{background:rgba(255,255,255,.02)}
  .muted{color:var(--muted)}
  a.link{color:var(--accent);text-decoration:none}
  a.link:hover{text-decoration:underline}
  .thumb{width:56px;height:56px;object-fit:cover;border-radius:10px;border:1px solid var(--border);background:#0b0e1a}
  .wrap{white-space:normal;word-break:break-word}
  .hdr-tools{display:inline-flex;gap:6px;margin-left:6px}
  .hdr-btn{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border:1px solid var(--border);background:var(--panel);border-radius:6px;cursor:pointer;font-size:12px}
  .hdr-btn.sort.active{border-color:rgba(255,214,107,.35);background:rgba(255,214,107,.1)}
  .menu{position:absolute;top:100%;left:0;margin-top:8px;width:min(360px,90vw);background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:10px;display:none;z-index:1000;max-height:70vh;overflow:auto}
  .menu.open{display:block}
  .pill{font-size:12px;padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:rgba(255,255,255,.04);display:inline-block;white-space:nowrap}
  .status-chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;cursor:pointer;user-select:none}
  .dot{width:12px;height:12px;border-radius:50%}
  .dot.green{background:#3ad07a}
  .dot.yellow{background:#ffd66b}
  .dot.red{background:#ff7b7b}
  .error{background:rgba(255,123,123,.1);border:1px solid rgba(255,123,123,.3);color:#ffc7c7;padding:12px;border-radius:8px;margin:16px 0}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:10000}
  .modal{width:min(720px,92vw);background:var(--panel);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.4);overflow:hidden}
  .modal header{background:linear-gradient(180deg,rgba(22,26,43,.7),rgba(22,26,43,.4));border-bottom:1px solid var(--border)}
  .modal h3{font-size:18px}
  .modal .content{padding:12px 16px 16px}
  .close-x{position:absolute;right:10px;top:10px;border:1px solid var(--border);background:transparent;color:#e9efff;border-radius:8px;padding:4px 8px;cursor:pointer}
  @media (max-width:720px){.container{padding:12px}thead th,tbody td{padding:10px}table{min-width:760px}}
</style>
</head>
<body>
<header>
  <div class="container">
    <h1>All Maps we track üó∫Ô∏è</h1>
    <div class="sub-lg">Below is a list of every Speedrun map/category we currently track on our website along with the best times for each!</div>
    <div class="sub-sm wrap" style="margin-top:8px">
      Some of these maps don't have an official name, so we have named some of these maps ourselves just for the purposes of referencing it on this website, like "Claustrophilia"(Impossible #3) or "Lemon Squeezer" (ID: Medium #2)! If we mistakenly named a map incorrectly which already had a name, please contact Abe (icarus1892) or Oli (interruptingpig) on the ball guys <a class="link" href="https://discord.gg/ballguys" target="_blank" rel="noopener">discord</a> and we will fix it
    </div>

    <div class="toolbar">
      <a class="btn" href="/home">‚Üê Back to Leaderboard</a>
      <span class="muted" id="rowInfo"></span>
      <span class="muted" style="margin-left:auto">Rows per page</span>
      <select id="pageSize" class="select">
        <option>5</option><option>10</option><option>25</option><option>50</option><option selected>100</option>
      </select>
    </div>
  </div>
</header>

<div class="container">
  <div id="errorContainer" style="display:none"></div>
  <div class="grid">
    <div class="grid-scroll">
      <table id="grid">
        <thead>
          <tr>
            <th data-col="thumb">Thumbnail</th>
            <th data-col="author">Map Author</th>
            <th data-col="map">Our Map Name</th>
            <th data-col="best">Best times</th>
            <th data-col="subs">Total submissions</th>
            <th data-col="id">Our Map ID</th>
          </tr>
        </thead>
        <tbody><tr><td colspan="6" class="muted" style="text-align:center;padding:40px">Loading‚Ä¶</td></tr></tbody>
      </table>
    </div>
  </div>
</div>

<div id="runsModal" class="modal-backdrop">
  <div class="modal">
    <header class="container" style="padding:12px 16px">
      <h3 id="modalTitle">Runs</h3>
      <button class="close-x" id="closeModal">Close</button>
    </header>
    <div class="content">
      <div class="grid">
        <div class="grid-scroll">
          <table id="runsTable">
            <thead><tr><th>Nickname</th><th>Time</th><th>Map Name</th><th>Status</th></tr></thead>
            <tbody><tr><td colspan="4" class="muted" style="text-align:center;padding:20px">Loading‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>
      <div class="muted" style="margin-top:8px">Above are the top runs for this map</div>
    </div>
  </div>
</div>

<script>
const ENDPOINT='https://script.google.com/macros/s/AKfycbxfbyHMjpva08fMkfmo26JDVtVFE_fbIpkouvB8Bw2YF3QflbiGR4oNdT-CI6Mf6Ug4KA/exec';
const JSONP_TIMEOUT_MS=25000,JSONP_RETRIES=2;
const state={data:[],pageSize:100,page:1,loading:false};

function showError(msg){
  let c=document.getElementById('errorContainer');
  if(!c){c=document.createElement('div');c.id='errorContainer';document.body.appendChild(c);}
  c.innerHTML=`<div class="error">${msg}</div>`;c.style.display='block';
}
function hideError(){const c=document.getElementById('errorContainer');if(c)c.style.display='none';}
function toDriveThumb(u){if(!u)return'';const m=u.match(/[-\w]{25,}/);return m?`https://drive.google.com/thumbnail?id=${m[0]}&sz=w120`:u;}
function drivePreviewFallback(i,u){const m=u.match(/[-\w]{25,}/);if(m)i.src=`https://drive.google.com/uc?export=view&id=${m[0]}`;}
function formatTime(ms){ms=+ms||0;if(ms<=0)return'0:00.00';const s=Math.floor(ms/1000),m=Math.floor(s/60),r=s%60,h=Math.floor((ms%1000)/10);return`${m}:${String(r).padStart(2,'0')}.${String(h).padStart(2,'0')}`;}
function parseBest(t){t=String(t||'').trim();if(!t||t==='0')return{label:'No runs posted',level:0,ms:0};const m=t.match(/^(\d+)\s*by\s*(.+?)(\s*'{1,3})?$/i);if(!m)return{label:t,level:0};const ms=+m[1],usr=m[2].trim(),lvl=(m[3]||'').trim().length;return{label:`${formatTime(ms)} by ${usr}`,level:lvl,ms,usr};}
function levelClass(n){return n>=3?'red':n===2?'yellow':n===1?'green':'';}
function jsonp(u,p={},to=JSONP_TIMEOUT_MS){return new Promise((res,rej)=>{const cb='cb_'+Math.random().toString(36).slice(2);p.callback=cb;const q=new URLSearchParams(p).toString();const s=document.createElement('script');let d=false;s.src=`${u}?${q}`;window[cb]=r=>{if(d)return;d=true;res(r);cl();};s.onerror=()=>{if(d)return;d=true;rej(new Error('Net'));cl();};document.body.appendChild(s);const t=setTimeout(()=>{if(d)return;d=true;rej(new Error('Timeout'));cl();},to);function cl(){delete window[cb];s.remove();clearTimeout(t);}});}
async function jsonpWithRetry(u,p){let a=0;while(a<=JSONP_RETRIES){try{return await jsonp(u,{...p,_:Date.now()},JSONP_TIMEOUT_MS+a*5000);}catch(e){if(a===JSONP_RETRIES)throw e;await new Promise(r=>setTimeout(r,800*(a+1)*(a+1)));a++;}}}

async function fetchMaps(){
  if(state.loading)return;state.loading=true;
  try{hideError();const j=await jsonpWithRetry(ENDPOINT,{action:'maps'});
    if(!j||!Array.isArray(j.rows))throw new Error('Bad response');
    state.data=j.rows.map(r=>({thumb:toDriveThumb(r.thumb),thumbRaw:r.thumb||'',author:r.author||'',map:r.map||'',best:r.best||'',subs:r.subs||'',id:r.id||''}));
    render();
  }catch(e){console.error(e);if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',()=>showError('Failed to load maps: '+e.message),{once:true});else showError('Failed to load maps: '+e.message);}finally{state.loading=false;}
}

function render(){
  const g=document.getElementById('grid');if(!g)return;const tb=g.querySelector('tbody');if(!tb)return;
  if(!state.data.length){tb.innerHTML=`<tr><td colspan="6" class="muted" style="text-align:center;padding:40px">No data</td></tr>`;return;}
  let html='';for(const r of state.data.slice(0,state.pageSize)){const b=parseBest(r.best);
    html+=`<tr>
      <td>${r.thumb?`<img class="thumb" src="${r.thumb}" loading="lazy" onerror="drivePreviewFallback(this,'${r.thumbRaw.replace(/'/g,"&#39;")}')">`:''}</td>
      <td>${r.author}</td>
      <td class="wrap">${r.map}</td>
      <td>${b.level?`<span class="status-chip" onclick="openRunsModal('${encodeURIComponent(r.map)}')"><span class="dot ${levelClass(b.level)}"></span>${b.label}</span>`:`<span class="pill">${b.label}</span>`}</td>
      <td>${r.subs==='0'?'No runs posted':r.subs}</td>
      <td>${r.id}</td></tr>`;}
  tb.innerHTML=html;
}

async function openRunsModal(m){
  const n=decodeURIComponent(m);document.getElementById('modalTitle').textContent=`Runs for: ${n}`;
  const mo=document.getElementById('runsModal');mo.style.display='flex';
  const tb=document.querySelector('#runsTable tbody');tb.innerHTML='<tr><td colspan=4 class="muted" style="text-align:center;padding:20px">Loading‚Ä¶</td></tr>';
  try{const j=await jsonpWithRetry(ENDPOINT,{action:'runsForMap',map:n});const r=Array.isArray(j.rows)?j.rows:[];if(!r.length){tb.innerHTML='<tr><td colspan=4 class="muted" style="text-align:center;padding:20px">No runs found.</td></tr>';return;}
    tb.innerHTML=r.map(x=>`<tr><td>${x[0]||''}</td><td>${formatTime(x[1])}</td><td>${x[2]||''}</td><td>${x[3]||''}</td></tr>`).join('');
  }catch(e){tb.innerHTML=`<tr><td colspan=4 class="muted" style="text-align:center;padding:20px">Failed: ${e.message}</td></tr>`;}
}
window.openRunsModal=openRunsModal;
document.getElementById('closeModal').onclick=()=>document.getElementById('runsModal').style.display='none';
document.getElementById('runsModal').onclick=e=>{if(e.target.id==='runsModal')e.currentTarget.style.display='none';};
document.addEventListener('DOMContentLoaded',()=>fetchMaps());
</script>
</body>
</html>
